# AI åŠ©æ‰‹å¢å¼ºæ’ä»¶ - é¡¹ç›®æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº WXT æ¡†æ¶å¼€å‘çš„æµè§ˆå™¨æ‰©å±•æ’ä»¶ï¼Œä¸“é—¨ç”¨äºå¢å¼ºä¸»æµ AI å¯¹è¯ç«™ç‚¹çš„ç”¨æˆ·ä½“éªŒã€‚æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸ºæ¯æ¡å¯¹è¯æ¶ˆæ¯æä¾›å”¯ä¸€æ ‡è¯†ï¼Œæ”¯æŒå¿«é€Ÿè·³è½¬ã€å¤åˆ¶ã€åˆ†äº«å’Œå¯¼å‡ºç­‰æ“ä½œã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ¶ˆæ¯è·³è½¬ç³»ç»Ÿ â­

- **å”¯ä¸€æ ‡è¯†**: ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€çš„ `messageId`
- **URL è·³è½¬**: é€šè¿‡ URL hash å¿«é€Ÿè·³è½¬åˆ°æŒ‡å®šæ¶ˆæ¯
- **è‡ªåŠ¨é«˜äº®**: è·³è½¬åè‡ªåŠ¨é«˜äº®ç›®æ ‡æ¶ˆæ¯
- **å†å²è®°å½•**: è®°å½•è·³è½¬å†å²ï¼Œæ”¯æŒè¿”å›ä¸Šä¸€ä½ç½®

### 2. æ¶ˆæ¯ç®¡ç†

- **è‡ªåŠ¨è¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«å’Œè®°å½•å¯¹è¯æ¶ˆæ¯
- **å¿«é€Ÿå¤åˆ¶**: ä¸€é”®å¤åˆ¶æ¶ˆæ¯å†…å®¹
- **åˆ†äº«é“¾æ¥**: ç”Ÿæˆå¯åˆ†äº«çš„æ¶ˆæ¯è·³è½¬é“¾æ¥
- **å¤šæ ¼å¼å¯¼å‡º**: æ”¯æŒ JSON/Markdown/TXT æ ¼å¼å¯¼å‡º

### 3. å¤šç«™ç‚¹æ”¯æŒ

- âœ… ChatGPT (chatgpt.com, chat.openai.com)
- âœ… Claude (claude.ai)
- âœ… Gemini (gemini.google.com)
- ğŸ”œ å¯æ‰©å±•æ”¯æŒæ›´å¤šç«™ç‚¹

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           UI Layer (Popup)               â”‚
â”‚  - æ¶ˆæ¯åˆ—è¡¨å±•ç¤º                          â”‚
â”‚  - æ“ä½œæŒ‰é’®                              â”‚
â”‚  - è®¾ç½®ç•Œé¢                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service Layer                   â”‚
â”‚  - MessageService: æ¶ˆæ¯ç®¡ç†             â”‚
â”‚  - JumpService: è·³è½¬åŠŸèƒ½                â”‚
â”‚  - StorageService: æ•°æ®æŒä¹…åŒ–           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Detector Layer                   â”‚
â”‚  - SiteDetector: ç«™ç‚¹æ£€æµ‹æ¥å£           â”‚
â”‚  - ChatGPTDetector: ChatGPT å®ç°         â”‚
â”‚  - ClaudeDetector: Claude å®ç°          â”‚
â”‚  - GeminiDetector: Gemini å®ç°          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Utility Layer                   â”‚
â”‚  - DOM æ“ä½œ                              â”‚
â”‚  - æ¶ˆæ¯è§£æ                              â”‚
â”‚  - URL å¤„ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
ai-assistant/
â”œâ”€â”€ entrypoints/              # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ background.ts         # åå°è„šæœ¬
â”‚   â”œâ”€â”€ content.ts            # å†…å®¹è„šæœ¬
â”‚   â”œâ”€â”€ popup/                # å¼¹çª—ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ App.tsx           # ä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ App.css           # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.html        # HTML æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ options/              # é€‰é¡¹é¡µé¢
â”œâ”€â”€ components/               # å…±äº«ç»„ä»¶
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ messageService.ts     # æ¶ˆæ¯å¤„ç†æœåŠ¡
â”‚   â”œâ”€â”€ jumpService.ts        # è·³è½¬æœåŠ¡
â”‚   â””â”€â”€ storageService.ts     # å­˜å‚¨æœåŠ¡
â”œâ”€â”€ detectors/                # ç«™ç‚¹æ£€æµ‹å™¨
â”‚   â”œâ”€â”€ chatgpt.ts            # ChatGPT æ£€æµ‹å™¨
â”‚   â”œâ”€â”€ claude.ts             # Claude æ£€æµ‹å™¨
â”‚   â”œâ”€â”€ gemini.ts             # Gemini æ£€æµ‹å™¨
â”‚   â””â”€â”€ index.ts              # æ£€æµ‹å™¨å·¥å‚
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ dom.ts                # DOM æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ messageParser.ts      # æ¶ˆæ¯è§£æå·¥å…·
â”‚   â””â”€â”€ url.ts                # URL å¤„ç†å·¥å…·
â”œâ”€â”€ types/                    # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ message.ts            # æ¶ˆæ¯ç±»å‹
â”‚   â”œâ”€â”€ site.ts               # ç«™ç‚¹ç±»å‹
â”‚   â””â”€â”€ config.ts             # é…ç½®ç±»å‹
â”œâ”€â”€ assets/                   # é™æ€èµ„æº
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ARCHITECTURE.md           # æ¶æ„è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md             # å¿«é€Ÿå¼€å§‹æŒ‡å—
â””â”€â”€ PROJECT_SUMMARY.md        # é¡¹ç›®æ€»ç»“ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: WXT (Web Extension Tools)
- **å‰ç«¯**: React 19 + TypeScript
- **æ„å»ºå·¥å…·**: Vite (é€šè¿‡ WXT)
- **å­˜å‚¨**: browser.storage.local
- **é€šä¿¡**: Chrome Extension Messaging API

## ğŸ“Š æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 1. MessageService (æ¶ˆæ¯æœåŠ¡)

**ä½ç½®**: `services/messageService.ts`

**èŒè´£**:

- æ¶ˆæ¯çš„è¯†åˆ«ã€æå–å’Œç®¡ç†
- ç›‘å¬ DOM å˜åŒ–ï¼Œè‡ªåŠ¨æ•è·æ–°æ¶ˆæ¯
- ä¸ºæ¯æ¡æ¶ˆæ¯ç”Ÿæˆå”¯ä¸€ ID
- æä¾›æ¶ˆæ¯æ“ä½œæ¥å£ï¼ˆå¤åˆ¶ã€åˆ†äº«ã€å¯¼å‡ºç­‰ï¼‰

**æ ¸å¿ƒæ–¹æ³•**:

```typescript
initialize(): Promise<void>           // åˆå§‹åŒ–æœåŠ¡
getAllMessages(): Message[]           // è·å–æ‰€æœ‰æ¶ˆæ¯
getMessageById(id: string): Message   // æ ¹æ® ID è·å–æ¶ˆæ¯
performAction(id: string, action: MessageAction): Promise<boolean>  // æ‰§è¡Œæ“ä½œ
```

### 2. JumpService (è·³è½¬æœåŠ¡)

**ä½ç½®**: `services/jumpService.ts`

**èŒè´£**:

- ç®¡ç†æ¶ˆæ¯è·³è½¬åŠŸèƒ½
- å¤„ç† URL hash å˜åŒ–
- è®°å½•è·³è½¬å†å²
- æä¾›è¿”å›ä¸Šä¸€ä½ç½®åŠŸèƒ½

**æ ¸å¿ƒæ–¹æ³•**:

```typescript
initialize(): void                    // åˆå§‹åŒ–æœåŠ¡
jumpToMessage(messageId: string): boolean  // è·³è½¬åˆ°æ¶ˆæ¯
generateJumpUrl(messageId: string): string  // ç”Ÿæˆè·³è½¬ URL
getJumpHistory(): JumpInfo[]         // è·å–è·³è½¬å†å²
jumpBack(): boolean                  // è¿”å›ä¸Šä¸€ä½ç½®
```

### 3. StorageService (å­˜å‚¨æœåŠ¡)

**ä½ç½®**: `services/storageService.ts`

**èŒè´£**:

- ä½¿ç”¨ browser.storage.local æŒä¹…åŒ–æ•°æ®
- ç®¡ç†æ’ä»¶é…ç½®
- æ”¯æŒæ•°æ®å¯¼å‡ºåŠŸèƒ½
- æä¾›æ•°æ®æ¸…ç†æ¥å£

**æ ¸å¿ƒæ–¹æ³•**:

```typescript
saveMessages(messages: Message[]): Promise<void>  // ä¿å­˜æ¶ˆæ¯
getMessages(): Promise<Message[]>                // è·å–æ¶ˆæ¯
saveConfig(config: PluginConfig): Promise<void>  // ä¿å­˜é…ç½®
exportData(format: string): Promise<void>        // å¯¼å‡ºæ•°æ®
```

### 4. SiteDetector (ç«™ç‚¹æ£€æµ‹å™¨)

**ä½ç½®**: `detectors/`

**èŒè´£**:

- å®šä¹‰ç»Ÿä¸€çš„ç«™ç‚¹æ£€æµ‹æ¥å£
- æ¯ä¸ªç«™ç‚¹å®ç°è‡ªå·±çš„æ£€æµ‹é€»è¾‘
- æä¾›æ¶ˆæ¯å…ƒç´ é€‰æ‹©å™¨
- æ”¯æŒæ»šåŠ¨åˆ°æŒ‡å®šæ¶ˆæ¯

**æ¥å£å®šä¹‰**:

```typescript
interface SiteDetector {
  detect(): SiteType | null; // æ£€æµ‹å½“å‰ç«™ç‚¹
  getMessages(): Promise<Message[]>; // è·å–æ¶ˆæ¯åˆ—è¡¨
  getMessageElement(messageId: string): HTMLElement | null; // è·å–æ¶ˆæ¯å…ƒç´ 
  scrollToMessage(messageId: string): boolean; // æ»šåŠ¨åˆ°æ¶ˆæ¯
}
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### æ¶ˆæ¯è¯†åˆ«æµç¨‹

```
é¡µé¢åŠ è½½ â†’ Content Script åˆå§‹åŒ– â†’ DetectorFactory æ£€æµ‹ç«™ç‚¹
â†’ MessageService åˆå§‹åŒ– â†’ æ‰«æé¡µé¢æ¶ˆæ¯ â†’ ç”Ÿæˆå”¯ä¸€ ID
â†’ æ·»åŠ  data-message-id å±æ€§ â†’ ç›‘å¬ DOM å˜åŒ–
```

### æ¶ˆæ¯è·³è½¬æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»è·³è½¬ â†’ Popup å‘é€æ¶ˆæ¯ â†’ Content Script æ¥æ”¶
â†’ JumpService.jumpToMessage() â†’ æŸ¥æ‰¾å…ƒç´  â†’ æ»šåŠ¨åˆ°ä½ç½®
â†’ é«˜äº®æ˜¾ç¤º â†’ è®°å½•å†å² â†’ è¿”å›ç»“æœ â†’ Popup å…³é—­
```

### æ¶ˆæ¯æ“ä½œæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ“ä½œ â†’ Popup å‘é€æ¶ˆæ¯ â†’ Content Script æ¥æ”¶
â†’ MessageService.performAction() â†’ æ‰§è¡Œå¯¹åº”æ“ä½œ
â†’ è¿”å›ç»“æœ â†’ Popup æ˜¾ç¤ºæç¤º
```

## ğŸ’¾ æ•°æ®å­˜å‚¨

### å­˜å‚¨ç»“æ„

```typescript
{
  "ai_assistant_messages": Message[],      // æ¶ˆæ¯åˆ—è¡¨
  "ai_assistant_config": PluginConfig,      // æ’ä»¶é…ç½®
  "ai_assistant_jump_history": JumpInfo[]   // è·³è½¬å†å²
}
```

### æ¶ˆæ¯æ•°æ®ç»“æ„

```typescript
interface Message {
  id: string; // å”¯ä¸€æ ‡è¯†
  role: "user" | "assistant"; // è§’è‰²
  content: string; // å†…å®¹
  timestamp: number; // æ—¶é—´æˆ³
  site: string; // ç«™ç‚¹
  conversationId: string; // å¯¹è¯ ID
  element?: HTMLElement; // DOM å…ƒç´ å¼•ç”¨
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘æ¨¡å¼

```bash
# Chrome
npm run dev

# Firefox
npm run dev:firefox
```

### æ„å»º

```bash
# Chrome
npm run build

# Firefox
npm run build:firefox
```

### åŠ è½½æ’ä»¶

1. è¿è¡Œ `npm run dev`
2. æ‰“å¼€ `chrome://extensions/`
3. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
4. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
5. é€‰æ‹© `.output/chrome-mv3` æ–‡ä»¶å¤¹

## ğŸ“ ä½¿ç”¨è¯´æ˜

### æ¶ˆæ¯è·³è½¬

1. åœ¨æ”¯æŒçš„ AI ç«™ç‚¹è¿›è¡Œå¯¹è¯
2. ç‚¹å‡»æ’ä»¶å›¾æ ‡æ‰“å¼€å¼¹çª—
3. åœ¨æ¶ˆæ¯åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡æ¶ˆæ¯
4. ç‚¹å‡»"â¬†ï¸ è·³è½¬"æŒ‰é’®
5. é¡µé¢ä¼šè‡ªåŠ¨æ»šåŠ¨åˆ°è¯¥æ¶ˆæ¯å¹¶é«˜äº®æ˜¾ç¤º

### åˆ†äº«æ¶ˆæ¯

1. åœ¨æ¶ˆæ¯åˆ—è¡¨ä¸­ç‚¹å‡»"ğŸ”— åˆ†äº«"æŒ‰é’®
2. è·³è½¬é“¾æ¥ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
3. åˆ†äº«é“¾æ¥æ ¼å¼ï¼š`https://site.com/conversation#messageId`

### å¯¼å‡ºæ•°æ®

1. æ‰“å¼€æ’ä»¶å¼¹çª—
2. åˆ‡æ¢åˆ°"è®¾ç½®"æ ‡ç­¾
3. é€‰æ‹©å¯¼å‡ºæ ¼å¼ï¼ˆJSON/Markdown/TXTï¼‰
4. ç‚¹å‡»å¯¹åº”çš„å¯¼å‡ºæŒ‰é’®

## ğŸ”® æœªæ¥è®¡åˆ’

- [ ] æ·»åŠ æ›´å¤š AI ç«™ç‚¹æ”¯æŒ
- [ ] å®ç°æ¶ˆæ¯æœç´¢åŠŸèƒ½
- [ ] æ·»åŠ æ¶ˆæ¯æ ‡ç­¾å’Œåˆ†ç±»
- [ ] æ”¯æŒæ¶ˆæ¯æ”¶è—åŠŸèƒ½
- [ ] å®ç°æ¶ˆæ¯å¯¹æ¯”åŠŸèƒ½
- [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ
- [ ] å®ç°æ¶ˆæ¯ç»Ÿè®¡å’Œåˆ†æ
- [ ] æ”¯æŒå¤šè¯­è¨€ç•Œé¢
- [ ] æ·»åŠ æ¶ˆæ¯ç¼–è¾‘åŠŸèƒ½
- [ ] å®ç°æ¶ˆæ¯æ¨¡æ¿åŠŸèƒ½

## ğŸ“ å­¦ä¹ èµ„æº

- [WXT å®˜æ–¹æ–‡æ¡£](https://wxt.dev/)
- [Chrome Extension å¼€å‘æŒ‡å—](https://developer.chrome.com/docs/extensions/)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: æœ¬æ’ä»¶ä»…ç”¨äºå¢å¼ºç”¨æˆ·ä½“éªŒï¼Œä¸ä¼šæ”¶é›†æˆ–ä¸Šä¼ ä»»ä½•ç”¨æˆ·æ•°æ®ã€‚æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ã€‚
